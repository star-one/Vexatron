<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>The Vexatron</title>
    <link rel="stylesheet" href="css/style.css" />
	<link rel="prefetch prerender" href="vexations.mp3" >
	<link rel="prefetch prerender" href="vexations-001.mp3" >
	<link rel="prefetch prerender" href="vexations-002.mp3" >
	<link rel="prefetch prerender" href="vexations-003.mp3" >
	<link rel="prefetch prerender" href="vexations-004.mp3" >
	<link rel="prefetch prerender" href="vexations-005.mp3" >
	<link rel="prefetch prerender" href="vexations-006.mp3" >
	<link rel="prefetch prerender" href="vexations-007.mp3" >
	<link rel="prefetch prerender" href="vexations-008.mp3" >
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  </head>
  <body>
	<div id="transport">
		<img class="button" alt="Play" src="images/play.png" onclick="playAud()" />
		<img class="button" alt="Stop" src="images/stop.png" onclick="stopAud()" />
	</div>
	<div id="progress">
		<progress id="progressBar" value="0" max="100" style="width:100%;"></progress>
		Cycle: <strong><span id="repeats">0</span></strong> 
		/ Elapsed time: <strong><span id="elapsedTime">00:00:00</span></strong> 
		/ <span id="elapsedPercent">0</span>%
	</div>
	<div id="cycles">
Total number of cycles: <span id="theTotalRepeats">5</span> / total time: <span id="theTotalTime">0:8:45</span> minutes.
<input type="range" name="totalRepeats" value=5 min=1 max=840 step=1 style="width:100%;" onChange="changeRepeats(this.value)">
	</div>
<audio id="audio1">
  <source src="vexations.mp3" type="audio/mp3">
  Your browser does not support HTML5 audio.
</audio>
<audio id="audio2">
  <source src="" type="audio/mp3">
</audio>
<audio id="audio3">
  <source src="" type="audio/mp3">
</audio>
<audio id="audio4">
  <source src="" type="audio/mp3">
</audio>

<script> 
myAudio=document.getElementById("audio1"); 
myAudio2=document.getElementById("audio2"); 
myAudio3=document.getElementById("audio3"); 
myAudio4=document.getElementById("audio4"); 

totalRepeats = 5;
totalTime = totalRepeats * 105;

function playAud()
  {   
  numRepeats = 1;
  elapsedTime = 0;

  myAudio.play(); 

  startTime = new Date();
  showStarttime = startTime.toLocaleTimeString();
  startMilliseconds = startTime.getTime();

  document.getElementById("elapsedTime").innerHTML=formatTime(elapsedTime);
  document.getElementById("repeats").innerHTML=numRepeats;
  bar = document.getElementById('progressBar');
 } 

function stopAud()
  { 
  myAudio.pause();
  myAudio.currentTime = 0;
  myAudio2.pause();
  myAudio2.currentTime = 0;
  myAudio3.pause();
  myAudio3.currentTime = 0;
  myAudio4.pause();
  myAudio4.currentTime = 0;
  
  clearInterval(myVar);
  document.getElementById("elapsedTime").innerHTML="00:00";
  } 

function formatTime(totalTime) {
  h = Math.floor(totalTime / (60 * 60) );
  totalTime = totalTime % (60 * 60);
  m = Math.floor(totalTime / (60) );
  totalTime = totalTime % (60);
  s = Math.floor(totalTime);
  properTime = h + ":" + m + ":" + s;
  return properTime;
}
function changeRepeats(newPosition)
  { 
  totalRepeats = newPosition;
  document.getElementById("theTotalRepeats").innerHTML=totalRepeats;
  totalTime = totalRepeats * 105; 
  document.getElementById("theTotalTime").innerHTML=formatTime(totalTime);
 } 

myVar=setInterval(function(){myTimer()},100);

function myTimer()
{
d = new Date();
t = d.toLocaleTimeString();

document.getElementById("repeats").innerHTML=numRepeats;

elapsedMilliseconds = d.getTime();
elapsedTime = (elapsedMilliseconds - startMilliseconds)/1000;
document.getElementById("elapsedTime").innerHTML=formatTime(elapsedTime);
elapsedPercent = (elapsedTime / totalTime) * 100;
elapsedPercent = elapsedPercent.toFixed(2);
document.getElementById("elapsedPercent").innerHTML=elapsedPercent;
bar.value = elapsedPercent;

if (myAudio.ended)
	{
	if (numRepeats < totalRepeats)
		{
		myAudio.currentTime = 0;
		myAudio.play();

		myAudioSrcNum = Math.floor((Math.random()*9)+1);		
		switch (myAudioSrcNum)
		{
		case 1:
			myAudio2.src="vexations-001.mp3";
		break;
		case 2:
			myAudio2.src="vexations-002.mp3";
		break;
		case 3:
			myAudio2.src="vexations-003.mp3";
		break;
		case 4:
			myAudio2.src="vexations-004.mp3";
		break;
		case 5:
			myAudio2.src="vexations-005.mp3";
		break;
		case 6:
			myAudio2.src="vexations-006.mp3";
		break;
		case 7:
			myAudio2.src="vexations-007.mp3";
		break;
		case 8:
			myAudio2.src="vexations-008.mp3";
		break;
		case 9:
			myAudio2.src="";
		break;
		}
		
		myAudioSrcNum = Math.floor((Math.random()*9)+1);
		switch (myAudioSrcNum)
		{
		case 1:
			myAudio3.src="vexations-001.mp3";
		break;
		case 2:
			myAudio3.src="vexations-002.mp3";
		break;
		case 3:
			myAudio3.src="vexations-003.mp3";
		break;
		case 4:
			myAudio3.src="vexations-004.mp3";
		break;
		case 5:
			myAudio3.src="vexations-005.mp3";
		break;
		case 6:
			myAudio3.src="vexations-006.mp3";
		break;
		case 7:
			myAudio3.src="vexations-007.mp3";
		break;
		case 8:
			myAudio3.src="vexations-008.mp3";
		break;
		case 9:
			myAudio3.src="";
		break;
		}
		
		myAudioSrcNum = Math.floor((Math.random()*9)+1);
		switch (myAudioSrcNum)
		{
		case 1:
			myAudio4.src="vexations-001.mp3";
		break;
		case 2:
			myAudio4.src="vexations-002.mp3";
		break;
		case 3:
			myAudio4.src="vexations-003.mp3";
		break;
		case 4:
			myAudio4.src="vexations-004.mp3";
		break;
		case 5:
			myAudio4.src="vexations-005.mp3";
		break;
		case 6:
			myAudio4.src="vexations-006.mp3";
		break;
		case 7:
			myAudio4.src="vexations-007.mp3";
		break;
		case 8:
			myAudio4.src="vexations-008.mp3";
		break;
		case 9:
			myAudio3.src="";
		break;
		}
		myAudio2.play();
		myAudio3.play();
		myAudio4.play();
		
		numRepeats = numRepeats + 1;
		}
		else
		{
		  	clearInterval(myVar);
  			document.getElementById("elapsedTime").innerHTML="00:00";
  			document.getElementById("elapsedTime").innerHTML=totalTime;
			document.getElementById("elapsedPercent").innerHTML="100";
		}
	}
}
</script>

            <div id="directions">
              <p>In order to play the theme 840 times in succession, it would be advisable to prepare oneself beforehand, and in the deepest silence, by serious immobilities.</p>
			  <p><em>Pour se jouer 840 fois de suite ce motif, il sera bon de se preparer au prealable, et dans le plus grand silence, par des immobilites serieuses.</em></p>
            </div>
  </body>
</html>
